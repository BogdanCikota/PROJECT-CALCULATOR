<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="node_modules/bootstrap/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="css/fonts.css">
    <link rel="stylesheet" href="css/index.css">
    <title>Calculator</title>
</head>
<body>
    <div class="container calc-container bg-dark mt-lg-5 mt-2  pb-2 ">
        <div class="row">
            <div id="display" class="col text-right mr-2 ml-2 p-2 text-white "></div>
        </div>
        <div class="row p-2">
            <button id="onOff" class="on-off-ac col rounded-circle mr-2 ml-2 p-2 bg-light">ON</button>
            <button id="ac" class="allBtn on-off-ac col rounded-circle mr-2 ml-2 p-2 bg-light">AC</button>
            <button id="c" class="allBtn on-off-ac col rounded-circle mr-2 ml-2 p-2 bg-light">C</button>
            <button class="allBtn numBtn operatorBtn col rounded-circle mr-2 ml-2 p-2 bg-warning text-white">/</button>
        </div>
        <div class="row p-2">
            <button class="allBtn numBtn col rounded-circle mr-2 ml-2 p-2 text-white bg-dark">7</button>
            <button class="allBtn numBtn col rounded-circle mr-2 ml-2 p-2 text-white bg-dark">8</button>
            <button class="allBtn numBtn col rounded-circle mr-2 ml-2 p-2 text-white bg-dark">9</button>
            <button class="allBtn numBtn operatorBtn col rounded-circle mr-2 ml-2 p-2 bg-warning text-white">*</button>
        </div>
        <div class="row p-2">
            <button class="allBtn numBtn col rounded-circle mr-2 ml-2 p-2 text-white bg-dark">4</button>
            <button class="allBtn numBtn col rounded-circle mr-2 ml-2 p-2 text-white bg-dark">5</button>
            <button class="allBtn numBtn col rounded-circle mr-2 ml-2 p-2 text-white bg-dark">6</button>
            <button class="allBtn numBtn operatorBtn col rounded-circle mr-2 ml-2 p-2 bg-warning text-white">-</button>
        </div>
        <div class="row p-2">
            <button class="allBtn numBtn col rounded-circle mr-2 ml-2 p-2 text-white bg-dark">1</button>
            <button class="allBtn numBtn col rounded-circle mr-2 ml-2 p-2 text-white bg-dark">2</button>
            <button class="allBtn numBtn col rounded-circle mr-2 ml-2 p-2 text-white bg-dark">3</button>
            <button class="allBtn numBtn operatorBtn col rounded-circle mr-2 ml-2 p-2 bg-warning text-white">+</button>
        </div>
        <div class="row p-2">
            <button class="allBtn numBtn col-5 rounded-pill mr-2 ml-2 p-2 text-white bg-dark">0</button>
            <button id="decimalBtn" class=" allBtn numBtn col rounded-circle mr-2 ml-2 p-2 text-white bg-dark">.</button>
            <button id="res" class="allBtn col rounded-circle mr-2 ml-2 p-2 bg-warning text-white">=</button>
        </div>
    </div>

    <script>
        //Your calculator is going to contain functions for all of the basic math
        // operators you typically find on simple calculators, 
        //so start by creating functions for the following items and testing them in your browser’s console.
        let num1;
        let num2;
        function add(num1, num2){
            return num1 + num2;
        }

        function subtract(num1, num2){
            return num1 - num2;
        }

        function multiply(num1, num2){
            return num1 * num2;
        }

        function divide(num1, num2){
            return num1 / num2;
        }
     
        
        //Create a new function "operate" that takes an operator and 2 numbers 
        //and then calls one of the above functions on the numbers.
        let operator;

        function operate(num1, operator, num2) {
            switch(operator) {
                case '+' :
                    return add(num1, num2);
                    break;
                case '-' :
                    return subtract(num1, num2);
                    break;
                case '*':
                    return multiply(num1, num2);
                    break;
                default:
                    return divide(num1, num2);
            }
        }

        // Make the calculator work! You’ll need to store the first number that is input into
        // the calculator when a user presses an operator, and also save which operation has been chosen and then
        // operate() on them when the user presses the “=” key.

        let display = document.querySelector('#display');
        let numBtn = document.querySelectorAll('.numBtn');
        let operatorTrueFalse = false;
        let operatorBtn = document.querySelectorAll('.operatorBtn');
        operatorBtn.forEach(btn => {
            btn.addEventListener('click', function(){
                operatorTrueFalse = true;
                operator = btn.textContent;
            });
            
        });
        
        //store num1, oprator, num2 in an array
        let arr = [];

        //make an array of numbers, and push() to arr
        let num = [];

        // Add a “backspace” button, so the user can undo if they click the wrong
        let backspace = document.querySelector('#c');
        backspace.addEventListener('click',function(){
            num.pop();
            display.textContent = num[num.length-1];
        });

        numBtn.forEach(btn => {
            btn.addEventListener('click', function(){
        //Disable the decimal button if there’s already one in the display
                let decimal = 0;
                let decimalBtn = document.querySelector('#decimalBtn');
                decimalBtn.addEventListener('click', function(){
                    decimal++;
                    if(decimal > 0) {
                        decimalBtn.disabled = 'true';
                    }
                });
                
                if(operatorTrueFalse === false ) {
                    display.textContent += btn.textContent;
                    num.push(display.textContent);
                } else {
                    decimalBtn.disabled = false;
                    arr.push(num[num.length-1]);
                    arr.push(operator);
                    operatorTrueFalse = false;
                    display.textContent = '';
                }

                arr = arr.filter(items => items !== undefined);
            });
        });

        //operate() on arr when the user presses the “=” key
       
        let resbtn = document.getElementById('res');
        let numOfMultiplicationDivision = [];
        let multiplicationDivisionIndex;
        let multiplicationDivision = [];
        let additionSubtraction = [];
        resbtn.addEventListener('click', function(){ 
            arr.push(num[num.length-1]);
            console.log(arr);
        //Display a snarky error message if the user tries to divide by 0

            let errorIndex = arr.findIndex(item => item === '/');
            if(arr[errorIndex+1] === '0'){
                display.textContent = 'Error';
                numBtn.forEach(btn => {
                    btn.disabled = 'true';
                });
                return false;
            }
            operatorTrueFalse = false;
            display.textContent = '';
            

            //operations precedence
            
            numOfMultiplicationDivision = arr.filter(item => item === '*' || item === '/');
            //loop through arr, find Multiplication,Division points, operate() on them and send them back to arr
            //for Addition/Subtraction
            for(let i = 0; i < numOfMultiplicationDivision.length; i++) {
                multiplicationDivisionIndex = arr.findIndex(item => item === '*' || item === '/');
                multiplicationDivision.push(arr[multiplicationDivisionIndex-1]);
                multiplicationDivision.push(arr[multiplicationDivisionIndex]);
                multiplicationDivision.push(arr[multiplicationDivisionIndex+1]);
                
                arr[multiplicationDivisionIndex-1] = operate(arr[multiplicationDivisionIndex-1], arr[multiplicationDivisionIndex],arr[multiplicationDivisionIndex+1]);
                arr.splice(multiplicationDivisionIndex, 2);
            }
            

            additionSubtraction = arr.filter(item => item === '+' || item === '-');
     
           //loop through arr,
           //( operate() on first three elements, return result to first position) * additionSubtraction.length
            for (let i = 0; i< additionSubtraction.length && arr.length>2; i++) {
                
                if(typeof(arr[0] !== 'number')) {
                    num1 = arr[0];
                    num1 = parseFloat(num1);
                    operator = arr[1];
                    num2 = arr[2];
                    num2 = parseFloat(num2);
                    arr.shift(num1);
                    arr.shift(operator);
                    arr.shift(num2);
                    num1 = operate(num1, operator, num2);
                    arr.unshift(num1);
                } else {
                    num1 = arr[0];
                    operator = arr[1];
                    num2 = arr[2];
                    num2 = parseFloat(num2);
                    arr.shift(num1);
                    arr.shift(operator);
                    arr.shift(num2);
                    num1 = operate(num1, operator, num2); 
                    arr.unshift(num1);
                }
            }
            
            display.textContent = arr[0];
            num = [];
            operatorTrueFalse = false;
        });
        
        //Pressing “ac” should wipe out any existing data
        function resetAll(){
            num1 = '';
            num2 = '';
            operator = '';
            arr = [];
            num = [];
            display.textContent = '';
            operatorTrueFalse = false;
            numBtn.forEach(btn => {
                btn.disabled = false;
            });
        }
        let ac = document.querySelector('#ac');
        ac.addEventListener('click', resetAll);

        //on/off button
        let allBtn = document.querySelectorAll('.allBtn');
            allBtn.forEach(btn => {
                btn.disabled = 'true';
                btn.style.opacity = '0.6';
            });
        
        let onOff = document.querySelector('#onOff');
        onOff.addEventListener('click', function(){
            if (onOff.textContent === 'ON') {
                onOff.textContent = 'OFF';
                allBtn.forEach(btn => {
                    btn.disabled = false;
                    btn.style.opacity = '1';
                });
            } else {
                resetAll();
                onOff.textContent = 'ON';
                allBtn.forEach(btn => {
                    btn.disabled = 'true';
                    btn.style.opacity = '0.6';
                });
            }
        });        

        //Future debugging:
        //2+-3 = 1
        //test 2*3 = 6.6+3 = NaN
    </script>
    
    <script src="node_modules/jquery/dist/jquery.min.js"></script>
    <script src="node_modules/popper.js/dist/umd/popper.min.js"></script>
    <script src="node_modules/bootstrap/dist/js/bootstrap.min.js"></script>
</body>
</html>